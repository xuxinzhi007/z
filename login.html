<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç™»å½• - Z+æ½®æµç¤¾åŒº</title>
    <!-- å¼•å…¥å¤–éƒ¨èµ„æº -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/mobile-optimization.css" rel="stylesheet">
    <!-- å¼•å…¥æ ¸å¿ƒä¸»é¢˜æ ·å¼ -->
    <style type="text/tailwindcss">
        @import url('css/theme-base.css');
    </style>

    <!-- å¼•å…¥ç”¨æˆ·ç®¡ç†æ¨¡å— -->
    <script src="js/userManager.js"></script>
    <!-- å¼•å…¥åŠ¨æ€ç®¡ç†æ¨¡å— -->
    <script src="js/postsManager.js"></script>
    <!-- å¼•å…¥æ‰‹åŠ¿ç®¡ç†æ¨¡å— -->
    <script src="js/gestureManager.js"></script>
    <!-- å¼•å…¥æ ¸å¿ƒä¸»é¢˜å¼•æ“ -->
    <script src="js/theme-core.js"></script>

    <style>
        /* æš—é»‘æ¨¡å¼é€‚é… */
        .dark body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }
        
        .dark .login-container {
            background: rgba(30, 41, 59, 0.95);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .dark .login-container h1 {
            color: white !important;
        }
        
        .dark .login-container p,
        .dark .text-gray-600,
        .dark .text-gray-500 {
            color: #94A3B8 !important;
        }
        
        .dark .input-field {
            background: #0F172A;
            border-color: #334155;
            color: white;
        }
        
        .dark .input-field:focus {
            background: #0F172A;
        }
        
        .dark .switch .slider {
            background-color: #334155;
        }
        
        .dark .forgot-modal {
            background: #1E293B;
            color: white;
        }
        
        .dark .forgot-modal h2 {
            color: white !important;
        }
        
        .dark .forgot-modal .bg-gray-100 {
            background-color: #334155;
            color: white;
        }
        
        .dark .forgot-modal .bg-white {
            background-color: #0F172A;
            border-color: #334155;
        }
        
        .dark .forgot-modal label {
            color: #E2E8F0 !important;
        }
        
        .dark .back-btn {
            background: rgba(30, 41, 59, 0.8);
            color: white;
        }
    </style>
    
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 25%, #ff9a9e 50%, #fad0c4 75%, #ffecd2 100%);
            background-size: 400% 400%;
            animation: gradientFlow 20s ease infinite;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* ç™»å½•å®¹å™¨ */
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px 32px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Logo */
        .logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #FF6B35, #FF7DAB);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
            animation: logoPulse 2s ease-in-out infinite;
        }

        @keyframes logoPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .input-field {
            width: 100%;
            padding: 14px 16px;
            padding-right: 48px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 15px;
            background: #f8fafc;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
        }

        .input-field:focus {
            border: 2px solid transparent;
            background: white;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.15);
            background-image: linear-gradient(white, white),
                            linear-gradient(135deg, #FF6B35, #40BFFF);
            background-origin: border-box;
            background-clip: padding-box, border-box;
        }

        .input-field.error {
            border-color: #ef4444;
            background: #fef2f2;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .input-field::placeholder {
            color: #94a3b8;
        }

        /* è¾“å…¥æ¡†å›¾æ ‡ */
        .input-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
        }

        .input-icon:hover {
            color: #FF6B35;
            transform: translateY(-50%) scale(1.2);
        }

        .input-icon.eye {
            animation: blink 3s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 90%, 100% { opacity: 1; }
            95% { opacity: 0.3; }
        }

        /* é”™è¯¯æç¤º */
        .error-message {
            display: none;
            color: #ef4444;
            font-size: 13px;
            margin-top: 6px;
            padding-left: 4px;
            animation: fadeInDown 0.3s;
        }

        .error-message.show {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ç™»å½•æŒ‰é’® */
        .login-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            background: linear-gradient(135deg, #FF6B35, #40BFFF);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            animation: buttonPulse 2s ease-in-out infinite;
        }

        @keyframes buttonPulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3); }
            50% { box-shadow: 0 8px 25px rgba(255, 107, 53, 0.5); }
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(255, 107, 53, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .login-btn.success {
            background: linear-gradient(135deg, #10b981, #34d399);
            animation: successPulse 0.6s;
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* åŠ è½½åŠ¨ç”» - è·³åŠ¨åœ†ç‚¹ */
        .loading-dots {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .loading-dots.show {
            display: flex;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: dotBounce 1.4s ease-in-out infinite;
        }

        .dot:nth-child(1) {
            background: #FF6B35;
            animation-delay: 0s;
        }

        .dot:nth-child(2) {
            background: #40BFFF;
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            background: #FF7DAB;
            animation-delay: 0.4s;
        }

        @keyframes dotBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* è®°ä½æˆ‘å¼€å…³ */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #FF6B35, #FF7DAB);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        /* å¿˜è®°å¯†ç é“¾æ¥ */
        .forgot-link {
            color: #FF6B35;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .forgot-link:hover {
            color: #FF7DAB;
            text-decoration: underline;
        }

        /* æ°”æ³¡é€šçŸ¥ */
        .bubble-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: white;
            padding: 16px 24px;
            border-radius: 16px;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bubble-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* å¿˜è®°å¯†ç å¼¹çª— */
        .forgot-modal {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            z-index: 2000;
            transition: bottom 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 85vh;
            overflow-y: auto;
        }

        .forgot-modal.show {
            bottom: 0;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1999;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B35, #40BFFF, #FF7DAB);
            background-size: 200% 100%;
            animation: progressGradient 2s linear infinite;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }

        @keyframes progressGradient {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        /* æ­¥éª¤å®Œæˆæ°”æ³¡ */
        .step-bubble {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 20px 32px;
            border-radius: 50px;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
            font-size: 18px;
            font-weight: 600;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .step-bubble.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        /* è¿”å›æŒ‰é’® */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .back-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        /* å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨ */
        .password-strength {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .strength-bar {
            flex: 1;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            transition: background 0.3s;
        }

        .strength-bar.active.weak {
            background: #ef4444;
        }

        .strength-bar.active.medium {
            background: #f59e0b;
        }

        .strength-bar.active.strong {
            background: #10b981;
        }
    </style>
</head>
<body class="antialiased transition-colors duration-300">
<!-- è¿”å›æŒ‰é’® -->
<button class="back-btn" onclick="goBack()">
    <i class="fa fa-arrow-left"></i>
</button>

<!-- ä¸»é¢˜åˆ‡æ¢ -->
<button id="theme-toggle-desktop" class="back-btn" style="left: 70px;" onclick="ZPlus.ThemeManager.toggle()">
    <i class="fa fa-moon-o"></i>
</button>

<!-- æ°”æ³¡é€šçŸ¥ -->
<div class="bubble-notification" id="bubbleNotification">
    <span style="font-size: 24px;">âœ…</span>
    <span id="notificationText">ç™»å½•æˆåŠŸï¼Œæ½®äººå·²ä¸Šçº¿ï½</span>
</div>

<!-- ç™»å½•å®¹å™¨ -->
<div class="login-container">
    <!-- Logo -->
    <div class="logo">Z</div>

    <!-- æ ‡é¢˜ -->
    <h1 class="text-2xl font-bold text-center mb-2" style="color: #1E293B;">æ¬¢è¿å›æ¥ï¼</h1>
    <p class="text-center text-gray-500 mb-8">ç»§ç»­ä½ çš„æ½®æµä¹‹æ—…ï½</p>

    <!-- ç™»å½•è¡¨å• -->
    <form id="loginForm" onsubmit="handleLogin(event)">
        <!-- è´¦å·è¾“å…¥æ¡† -->
        <div class="input-group">
            <input
                type="text"
                id="username"
                class="input-field"
                placeholder="è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±ï½"
                autocomplete="username"
            >
            <i class="fa fa-user input-icon"></i>
            <div class="error-message" id="usernameError">
                <span>âŒ</span>
                <span>ç”¨æˆ·åä¸èƒ½ä¸ºç©ºå“¦ï½</span>
            </div>
        </div>

        <!-- å¯†ç è¾“å…¥æ¡† -->
        <div class="input-group">
            <input
                type="password"
                id="password"
                class="input-field"
                placeholder="è¾“å…¥ä½ çš„å¯†ç "
                autocomplete="current-password"
            >
            <i class="fa fa-eye-slash input-icon eye" id="passwordToggle" onclick="togglePassword()"></i>
            <div class="error-message" id="passwordError">
                <span>âŒ</span>
                <span>æ½®å·æˆ–å¯†ç ä¸å¯¹å“¦ï¼Œå†æ£€æŸ¥ä¸‹ï½</span>
            </div>
        </div>

        <!-- è®°ä½æˆ‘ & å¿˜è®°å¯†ç  -->
        <div class="flex items-center justify-between mb-6">
            <label class="flex items-center gap-2 cursor-pointer">
                <label class="switch">
                    <input type="checkbox" id="rememberMe">
                    <span class="slider"></span>
                </label>
                <span class="text-sm text-gray-600">è®°ä½æˆ‘</span>
            </label>
            <a class="forgot-link" onclick="showForgotModal()">å¿˜è®°å¯†ç ï¼Ÿ</a>
        </div>

        <!-- ç™»å½•æŒ‰é’® -->
        <button type="submit" class="login-btn" id="loginBtn">
            <span id="btnText">å¼€å§‹æ½®æµ</span>
            <div class="loading-dots" id="loadingDots">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
        </button>
    </form>

    <!-- å…¶ä»–ç™»å½•æ–¹å¼ -->
    <div class="mt-6 text-center">
        <p class="text-sm text-gray-500 mb-4">æˆ–ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ç™»å½•</p>
        <div class="flex gap-3 justify-center">
            <button class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition" onclick="socialLogin('wechat')">
                <i class="fa fa-wechat text-xl" style="color: #07C160;"></i>
            </button>
            <button class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition" onclick="socialLogin('qq')">
                <i class="fa fa-qq text-xl" style="color: #12B7F5;"></i>
            </button>
            <button class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition" onclick="socialLogin('weibo')">
                <i class="fa fa-weibo text-xl" style="color: #E6162D;"></i>
            </button>
        </div>
    </div>

    <!-- æ³¨å†Œé“¾æ¥ -->
    <div class="mt-6 text-center">
        <span class="text-sm text-gray-500">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</span>
        <a href="register.html" class="text-sm font-medium ml-1" style="color: #FF6B35;">ç«‹å³æ³¨å†Œ</a>
    </div>
</div>

<!-- å¿˜è®°å¯†ç å¼¹çª— -->
<div class="modal-overlay" id="modalOverlay" onclick="hideForgotModal()"></div>
<div class="forgot-modal" id="forgotModal">
    <!-- è¿›åº¦æ¡ -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- å…³é—­æŒ‰é’® -->
    <button onclick="hideForgotModal()" class="absolute top-6 right-6 w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition">
        <i class="fa fa-times"></i>
    </button>

    <!-- æ ‡é¢˜ -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h2 class="text-xl font-bold mb-2" style="color: #1E293B;">æ‰¾å›å¯†ç </h2>
            <p class="text-sm text-gray-500">åˆ«æ‹…å¿ƒï¼Œè®©æˆ‘ä»¬å¸®ä½ æ‰¾å›ï½</p>
        </div>
        <button onclick="showDebugInfo()" class="px-3 py-1 rounded-full bg-gray-100 text-xs font-medium hover:bg-gray-200 transition" title="è°ƒè¯•æŒ‰é’®">
            ğŸ”§ è°ƒè¯•
        </button>
    </div>

    <!-- æ­¥éª¤1ï¼šè¾“å…¥ç”¨æˆ·å -->
    <div id="step1" class="step-content">
        <div class="input-group">
            <label class="block text-sm font-medium mb-2" style="color: #1E293B;">è¾“å…¥ä½ çš„æ½®å·</label>
            <input
                type="text"
                id="forgotUsername"
                class="input-field"
                placeholder="ä½ æ³¨å†Œæ—¶çš„ç”¨æˆ·å"
                oninput="checkUsername()"
            >
            <div class="error-message" id="forgotUsernameError">
                <span>âŒ</span>
                <span>æ‰¾ä¸åˆ°è¿™ä¸ªæ½®å·å“¦ï½</span>
            </div>
            <div class="text-sm mt-2" style="color: #10b981; display: none;" id="usernameFound">
                <span>âœ…</span>
                <span>å·²æ‰¾åˆ°ä½ çš„æ½®å·ï½</span>
            </div>
        </div>
        <button onclick="nextStep(2)" class="login-btn mt-6" id="step1Btn" disabled>
            ä¸‹ä¸€æ­¥
        </button>
    </div>

    <!-- æ­¥éª¤2ï¼šå®‰å…¨é—®é¢˜ -->
    <div id="step2" class="step-content" style="display: none;">
        <div class="input-group">
            <label class="block text-sm font-medium mb-2" style="color: #1E293B;">å®‰å…¨é—®é¢˜</label>
            <p class="text-sm text-gray-600 mb-4" id="securityQuestion">ä½ æœ€å–œæ¬¢çš„æ½®æµé£æ ¼ï¼Ÿ</p>
            <input
                type="text"
                id="securityAnswer"
                class="input-field"
                placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ"
                oninput="checkAnswer()"
            >
            <div class="error-message" id="answerError">
                <span>âŒ</span>
                <span>æ–¹å‘å¯¹å•¦ï¼Œå†å›å¿†ä¸‹ï½</span>
            </div>
            <div class="text-sm mt-2" style="color: #10b981; display: none;" id="answerCorrect">
                <span>âœ…</span>
                <span>ç­”æ¡ˆæ­£ç¡®ï¼</span>
            </div>
        </div>
        <div class="flex gap-3 mt-6">
            <button onclick="prevStep(1)" class="flex-1 py-3 rounded-full bg-gray-100 font-medium hover:bg-gray-200 transition">
                ä¸Šä¸€æ­¥
            </button>
            <button onclick="nextStep(3)" class="flex-1 login-btn" id="step2Btn" disabled>
                ä¸‹ä¸€æ­¥
            </button>
        </div>
    </div>

    <!-- æ­¥éª¤3ï¼šé‡ç½®å¯†ç  -->
    <div id="step3" class="step-content" style="display: none;">
        <div class="input-group">
            <label class="block text-sm font-medium mb-2" style="color: #1E293B;">è®¾ç½®æ–°å¯†ç </label>
            <input
                type="password"
                id="newPassword"
                class="input-field"
                placeholder="è‡³å°‘8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—"
                oninput="checkPasswordStrength()"
            >
            <i class="fa fa-eye-slash input-icon" onclick="toggleNewPassword()"></i>
            <div class="password-strength">
                <div class="strength-bar" id="bar1"></div>
                <div class="strength-bar" id="bar2"></div>
                <div class="strength-bar" id="bar3"></div>
                <div class="strength-bar" id="bar4"></div>
            </div>
            <p class="text-xs mt-2 text-gray-500" id="strengthText">è¯·è¾“å…¥å¯†ç </p>
        </div>
        <div class="input-group">
            <label class="block text-sm font-medium mb-2" style="color: #1E293B;">ç¡®è®¤æ–°å¯†ç </label>
            <input
                type="password"
                id="confirmPassword"
                class="input-field"
                placeholder="å†è¾“å…¥ä¸€æ¬¡æ–°å¯†ç "
                oninput="checkPasswordMatch()"
            >
            <div class="error-message" id="confirmError">
                <span>âŒ</span>
                <span>ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´å“¦ï½</span>
            </div>
        </div>
        <div class="flex gap-3 mt-6">
            <button onclick="prevStep(2)" class="flex-1 py-3 rounded-full bg-gray-100 font-medium hover:bg-gray-200 transition">
                ä¸Šä¸€æ­¥
            </button>
            <button onclick="resetPassword()" class="flex-1 login-btn" id="step3Btn" disabled>
                å®Œæˆé‡ç½®
            </button>
        </div>
        <div class="text-center mt-4">
            <p class="text-xs text-gray-500 mb-2">è¿˜æ˜¯æƒ³ä¸èµ·æ¥ï¼Ÿ</p>
            <button onclick="nextStep(4)" class="text-xs text-red-600 hover:text-red-700 font-medium">
                é‡ç½®è´¦å·æ•°æ® â†’
            </button>
        </div>
    </div>

    <!-- æ­¥éª¤4ï¼šé‡ç½®è´¦å·ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰ -->
    <div id="step4" class="step-content" style="display: none;">
        <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
            <p class="text-sm text-red-700 font-medium mb-2">âš ï¸ é‡ç½®è´¦å·æ•°æ®</p>
            <p class="text-xs text-red-600">æ­¤æ“ä½œå°†æ¸…é™¤è¯¥è´¦å·çš„æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬å‘å¸ƒçš„åŠ¨æ€ï¼‰ï¼Œè¯·è°¨æ…æ“ä½œï¼</p>
        </div>
        <div class="input-group">
            <label class="block text-sm font-medium mb-2" style="color: #1E293B;">è®¾ç½®æ–°å¯†ç </label>
            <input
                type="password"
                id="resetNewPassword"
                class="input-field"
                placeholder="è‡³å°‘8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—"
                oninput="checkResetPasswordStrength()"
            >
            <i class="fa fa-eye-slash input-icon" onclick="toggleResetPassword()"></i>
            <div class="password-strength">
                <div class="strength-bar" id="resetBar1"></div>
                <div class="strength-bar" id="resetBar2"></div>
                <div class="strength-bar" id="resetBar3"></div>
                <div class="strength-bar" id="resetBar4"></div>
            </div>
            <p class="text-xs mt-2 text-gray-500" id="resetStrengthText">è¯·è¾“å…¥å¯†ç </p>
        </div>
        <div class="input-group">
            <label class="block text-sm font-medium mb-2" style="color: #1E293B;">ç¡®è®¤æ–°å¯†ç </label>
            <input
                type="password"
                id="resetConfirmPassword"
                class="input-field"
                placeholder="å†è¾“å…¥ä¸€æ¬¡æ–°å¯†ç "
                oninput="checkResetPasswordMatch()"
            >
            <div class="error-message" id="resetConfirmError">
                <span>âŒ</span>
                <span>ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´å“¦ï½</span>
            </div>
        </div>
        <div class="flex gap-3 mt-6">
            <button onclick="prevStep(1)" class="flex-1 py-3 rounded-full bg-gray-100 font-medium hover:bg-gray-200 transition">
                è¿”å›
            </button>
            <button onclick="resetAccountData()" class="flex-1 login-btn" id="step4Btn" disabled style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                ç¡®è®¤é‡ç½®
            </button>
        </div>
    </div>
</div>

<!-- è°ƒè¯•ä¿¡æ¯å¼¹çª— -->
<div class="modal-overlay" id="debugOverlay" onclick="hideDebugInfo()"></div>
<div class="forgot-modal" id="debugModal" style="max-height: 80vh; overflow-y: auto;">
    <button onclick="hideDebugInfo()" class="absolute top-6 right-6 w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition">
        <i class="fa fa-times"></i>
    </button>

    <h2 class="text-xl font-bold mb-4" style="color: #1E293B;">ğŸ”§ è°ƒè¯•ä¿¡æ¯</h2>
    
    <div class="bg-gray-50 rounded-lg p-4 mb-4">
        <h3 class="font-bold text-sm mb-3" style="color: #1E293B;">æ‰€æœ‰æ³¨å†Œè´¦å·</h3>
        <div id="debugUsersList" class="space-y-3 max-h-96 overflow-y-auto">
            <p class="text-sm text-gray-500">åŠ è½½ä¸­...</p>
        </div>
    </div>

    <div class="text-center">
        <button onclick="hideDebugInfo()" class="px-6 py-2 rounded-full bg-gray-100 font-medium hover:bg-gray-200 transition">
            å…³é—­
        </button>
    </div>
</div>

<!-- æ­¥éª¤å®Œæˆæ°”æ³¡ -->
<div class="step-bubble" id="stepBubble">
    <span>âœ… æå®šï¼</span>
</div>

<script>
    // è¿”å›åŠŸèƒ½
    function goBack() {
        window.location.href = 'index.html';
    }

    // å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢
    function togglePassword() {
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('passwordToggle');

        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('fa-eye-slash');
            toggleIcon.classList.add('fa-eye');
        } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('fa-eye');
            toggleIcon.classList.add('fa-eye-slash');
        }

        // çœ¨çœ¼åŠ¨ç”»
        toggleIcon.style.animation = 'none';
        setTimeout(() => {
            toggleIcon.style.animation = 'blink 3s ease-in-out infinite';
        }, 10);
    }

    // ç™»å½•è¡¨å•æäº¤
    function handleLogin(event) {
        event.preventDefault();

        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const usernameError = document.getElementById('usernameError');
        const passwordError = document.getElementById('passwordError');
        const loginBtn = document.getElementById('loginBtn');
        const btnText = document.getElementById('btnText');
        const loadingDots = document.getElementById('loadingDots');

        // é‡ç½®é”™è¯¯çŠ¶æ€
        document.getElementById('username').classList.remove('error');
        document.getElementById('password').classList.remove('error');
        usernameError.classList.remove('show');
        passwordError.classList.remove('show');

        // éªŒè¯
        let hasError = false;
        if (!username) {
            document.getElementById('username').classList.add('error');
            usernameError.classList.add('show');
            hasError = true;
        }
        if (!password) {
            document.getElementById('password').classList.add('error');
            passwordError.querySelector('span:last-child').textContent = 'å¯†ç ä¸èƒ½ä¸ºç©ºå“¦ï½';
            passwordError.classList.add('show');
            hasError = true;
        }

        if (hasError) {
            // éœ‡åŠ¨åé¦ˆ
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
            return;
        }

        // çœŸå®ç™»å½•éªŒè¯
        loginBtn.classList.add('loading');
        btnText.style.display = 'none';
        loadingDots.classList.add('show');

        setTimeout(() => {
            // è°ƒç”¨UserManageréªŒè¯ç™»å½•
            const result = UserManager.loginUser(username, password);

            if (result.success) {
                // ç™»å½•æˆåŠŸ
                loginBtn.classList.remove('loading');
                loginBtn.classList.add('success');
                btnText.textContent = 'ç™»å½•æˆåŠŸï¼';
                btnText.style.display = 'block';
                loadingDots.classList.remove('show');

                // æ˜¾ç¤ºæ°”æ³¡é€šçŸ¥
                showNotification('âœ…', result.message);

                // è·³è½¬åˆ°é¦–é¡µ
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            } else {
                // ç™»å½•å¤±è´¥
                loginBtn.classList.remove('loading');
                btnText.style.display = 'block';
                loadingDots.classList.remove('show');

                document.getElementById('password').classList.add('error');
                passwordError.querySelector('span:last-child').textContent = result.message;
                passwordError.classList.add('show');

                // éœ‡åŠ¨åé¦ˆ
                if ('vibrate' in navigator) {
                    navigator.vibrate([50, 100, 50]);
                }
            }
        }, 1500);
    }

    // æ˜¾ç¤ºæ°”æ³¡é€šçŸ¥
    function showNotification(icon, text) {
        const notification = document.getElementById('bubbleNotification');
        const notificationText = document.getElementById('notificationText');

        notification.querySelector('span:first-child').textContent = icon;
        notificationText.textContent = text;
        notification.classList.add('show');

        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // ç¤¾äº¤ç™»å½•
    function socialLogin(platform) {
        const platformNames = {
            'wechat': 'å¾®ä¿¡',
            'qq': 'QQ',
            'weibo': 'å¾®åš'
        };
        showNotification('ğŸ””', `${platformNames[platform]}ç™»å½•åŠŸèƒ½å¼€å‘ä¸­...`);
    }

    // æ˜¾ç¤ºå¿˜è®°å¯†ç å¼¹çª—
    function showForgotModal() {
        document.getElementById('modalOverlay').classList.add('show');
        document.getElementById('forgotModal').classList.add('show');
        document.body.style.overflow = 'hidden';
        updateProgress(33);
    }

    // éšè—å¿˜è®°å¯†ç å¼¹çª—
    function hideForgotModal() {
        document.getElementById('modalOverlay').classList.remove('show');
        document.getElementById('forgotModal').classList.remove('show');
        document.body.style.overflow = 'auto';

        // é‡ç½®è¡¨å•
        resetForgotForm();
    }

    // é‡ç½®å¿˜è®°å¯†ç è¡¨å•
    function resetForgotForm() {
        document.getElementById('step1').style.display = 'block';
        document.getElementById('step2').style.display = 'none';
        document.getElementById('step3').style.display = 'none';
        document.getElementById('forgotUsername').value = '';
        document.getElementById('securityAnswer').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';
        updateProgress(33);
    }

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress(percent) {
        document.getElementById('progressFill').style.width = percent + '%';
    }

    // æ£€æŸ¥ç”¨æˆ·å
    function checkUsername() {
        const username = document.getElementById('forgotUsername').value.trim();
        const btn = document.getElementById('step1Btn');
        const found = document.getElementById('usernameFound');
        const error = document.getElementById('forgotUsernameError');

        if (username.length >= 3) {
            // æ¨¡æ‹Ÿæ£€æŸ¥ï¼ˆæ¼”ç¤ºç”¨ï¼‰
            setTimeout(() => {
                const exists = Math.random() > 0.3; // 70%å­˜åœ¨

                if (exists) {
                    found.style.display = 'block';
                    error.classList.remove('show');
                    btn.disabled = false;
                    btn.style.opacity = '1';
                } else {
                    found.style.display = 'none';
                    error.classList.add('show');
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
            }, 500);
        } else {
            found.style.display = 'none';
            error.classList.remove('show');
            btn.disabled = true;
            btn.style.opacity = '0.5';
        }
    }

    // æ£€æŸ¥å®‰å…¨é—®é¢˜ç­”æ¡ˆ
    function checkAnswer() {
        const answer = document.getElementById('securityAnswer').value.trim();
        const btn = document.getElementById('step2Btn');
        const correct = document.getElementById('answerCorrect');
        const error = document.getElementById('answerError');

        if (answer.length >= 2) {
            // æ¨¡æ‹Ÿæ¨¡ç³ŠåŒ¹é…ï¼ˆæ¼”ç¤ºç”¨ï¼‰
            setTimeout(() => {
                const isCorrect = answer.toLowerCase().includes('è¡—å¤´') ||
                                 answer.toLowerCase().includes('å¤å¤') ||
                                 answer.toLowerCase().includes('y2k');

                if (isCorrect) {
                    correct.style.display = 'block';
                    error.classList.remove('show');
                    btn.disabled = false;
                    btn.style.opacity = '1';
                } else {
                    correct.style.display = 'none';
                    error.classList.add('show');
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
            }, 300);
        } else {
            correct.style.display = 'none';
            error.classList.remove('show');
            btn.disabled = true;
            btn.style.opacity = '0.5';
        }
    }

    // ä¸‹ä¸€æ­¥
    function nextStep(step) {
        // æ˜¾ç¤ºå®Œæˆæ°”æ³¡
        showStepBubble();

        // éšè—å½“å‰æ­¥éª¤
        for (let i = 1; i <= 3; i++) {
            document.getElementById('step' + i).style.display = 'none';
        }

        // æ˜¾ç¤ºä¸‹ä¸€æ­¥
        setTimeout(() => {
            document.getElementById('step' + step).style.display = 'block';
            updateProgress(step * 33);
        }, 600);
    }

    // ä¸Šä¸€æ­¥
    function prevStep(step) {
        for (let i = 1; i <= 3; i++) {
            document.getElementById('step' + i).style.display = 'none';
        }
        document.getElementById('step' + step).style.display = 'block';
        updateProgress(step * 33);
    }

    // æ˜¾ç¤ºæ­¥éª¤å®Œæˆæ°”æ³¡
    function showStepBubble() {
        const bubble = document.getElementById('stepBubble');
        bubble.classList.add('show');

        setTimeout(() => {
            bubble.classList.remove('show');
        }, 1000);
    }

    // åˆ‡æ¢æ–°å¯†ç æ˜¾ç¤º
    function toggleNewPassword() {
        const input = document.getElementById('newPassword');
        const icon = event.target;

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        }
    }

    // æ£€æŸ¥å¯†ç å¼ºåº¦
    function checkPasswordStrength() {
        const password = document.getElementById('newPassword').value;
        const bars = ['bar1', 'bar2', 'bar3', 'bar4'];
        const strengthText = document.getElementById('strengthText');

        // é‡ç½®
        bars.forEach(bar => {
            document.getElementById(bar).classList.remove('active', 'weak', 'medium', 'strong');
        });

        if (password.length === 0) {
            strengthText.textContent = 'è¯·è¾“å…¥å¯†ç ';
            strengthText.style.color = '#94a3b8';
            return;
        }

        let strength = 0;
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^a-zA-Z0-9]/.test(password)) strength++;

        let level, levelText, color;
        if (strength <= 2) {
            level = 'weak';
            levelText = 'å¯†ç å¼ºåº¦ï¼šå¼±';
            color = '#ef4444';
            bars.slice(0, 1).forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        } else if (strength <= 3) {
            level = 'medium';
            levelText = 'å¯†ç å¼ºåº¦ï¼šä¸­ç­‰';
            color = '#f59e0b';
            bars.slice(0, 3).forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        } else {
            level = 'strong';
            levelText = 'å¯†ç å¼ºåº¦ï¼šå¼º';
            color = '#10b981';
            bars.forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        }

        strengthText.textContent = levelText;
        strengthText.style.color = color;

        checkPasswordMatch();
    }

    // æ£€æŸ¥å¯†ç åŒ¹é…
    function checkPasswordMatch() {
        const password = document.getElementById('newPassword').value;
        const confirm = document.getElementById('confirmPassword').value;
        const btn = document.getElementById('step3Btn');
        const error = document.getElementById('confirmError');

        if (confirm.length === 0) {
            error.classList.remove('show');
            btn.disabled = true;
            btn.style.opacity = '0.5';
            return;
        }

        if (password === confirm && password.length >= 8) {
            error.classList.remove('show');
            btn.disabled = false;
            btn.style.opacity = '1';
        } else {
            error.classList.add('show');
            btn.disabled = true;
            btn.style.opacity = '0.5';
        }
    }

    // é‡ç½®å¯†ç 
    function resetPassword() {
        showStepBubble();

        setTimeout(() => {
            updateProgress(100);
            showNotification('ğŸ‰', 'å¯†ç é‡ç½®æˆåŠŸï¼æ­£åœ¨è¿”å›ç™»å½•...');

            setTimeout(() => {
                hideForgotModal();
            }, 2000);
        }, 600);
    }

    // ========== è°ƒè¯•åŠŸèƒ½ ==========

    // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
    function showDebugInfo() {
        const debugOverlay = document.getElementById('debugOverlay');
        const debugModal = document.getElementById('debugModal');
        
        debugOverlay.classList.add('show');
        debugModal.classList.add('show');
        document.body.style.overflow = 'hidden';

        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        loadDebugUsersList();
    }

    // éšè—è°ƒè¯•ä¿¡æ¯
    function hideDebugInfo() {
        const debugOverlay = document.getElementById('debugOverlay');
        const debugModal = document.getElementById('debugModal');
        
        debugOverlay.classList.remove('show');
        debugModal.classList.remove('show');
        document.body.style.overflow = 'auto';
    }

    // åŠ è½½è°ƒè¯•ç”¨æˆ·åˆ—è¡¨
    function loadDebugUsersList() {
        const users = JSON.parse(localStorage.getItem('z_users') || '{}');
        const usersList = document.getElementById('debugUsersList');

        if (Object.keys(users).length === 0) {
            usersList.innerHTML = '<p class="text-sm text-gray-500">æš‚æ— è´¦å·</p>';
            return;
        }

        usersList.innerHTML = Object.entries(users).map(([username, user]) => {
            const decryptedPassword = atob(user.password);
            return `
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-sm">${username}</span>
                        <button onclick="copyToClipboard('${username}')" class="text-xs px-2 py-1 rounded bg-blue-100 text-blue-600 hover:bg-blue-200 transition">
                            å¤åˆ¶ç”¨æˆ·å
                        </button>
                    </div>
                    <div class="text-xs text-gray-600 space-y-1">
                        <div><strong>å¯†ç ï¼š</strong> <code class="bg-gray-100 px-2 py-1 rounded">${decryptedPassword}</code>
                            <button onclick="copyToClipboard('${decryptedPassword}')" class="ml-2 text-blue-600 hover:text-blue-800">ğŸ“‹</button>
                        </div>
                        <div><strong>æ ‡ç­¾ï¼š</strong> ${user.tags.join(', ')}</div>
                        <div><strong>ç­¾åï¼š</strong> ${user.signature}</div>
                        <div><strong>æ³¨å†Œæ—¶é—´ï¼š</strong> ${new Date(user.createTime).toLocaleString()}</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        });
    }

    // ========== è´¦å·é‡ç½®åŠŸèƒ½ ==========

    // æ˜¾ç¤ºé‡ç½®è´¦å·é€‰é¡¹
    function showResetAccountOption() {
        // éšè—å‰é¢çš„æ­¥éª¤
        for (let i = 1; i <= 3; i++) {
            document.getElementById('step' + i).style.display = 'none';
        }
        document.getElementById('step4').style.display = 'block';
        updateProgress(100);
    }

    // æ£€æŸ¥é‡ç½®å¯†ç å¼ºåº¦
    function checkResetPasswordStrength() {
        const password = document.getElementById('resetNewPassword').value;
        const bars = ['resetBar1', 'resetBar2', 'resetBar3', 'resetBar4'];
        const strengthText = document.getElementById('resetStrengthText');

        bars.forEach(bar => {
            document.getElementById(bar).classList.remove('active', 'weak', 'medium', 'strong');
        });

        if (password.length === 0) {
            strengthText.textContent = 'è¯·è¾“å…¥å¯†ç ';
            strengthText.style.color = '#94a3b8';
            return;
        }

        let strength = 0;
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^a-zA-Z0-9]/.test(password)) strength++;

        let level, levelText, color;
        if (strength <= 2) {
            level = 'weak';
            levelText = 'å¯†ç å¼ºåº¦ï¼šå¼±';
            color = '#ef4444';
            bars.slice(0, 1).forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        } else if (strength <= 3) {
            level = 'medium';
            levelText = 'å¯†ç å¼ºåº¦ï¼šä¸­ç­‰';
            color = '#f59e0b';
            bars.slice(0, 3).forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        } else {
            level = 'strong';
            levelText = 'å¯†ç å¼ºåº¦ï¼šå¼º';
            color = '#10b981';
            bars.forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        }

        strengthText.textContent = levelText;
        strengthText.style.color = color;

        checkResetPasswordMatch();
    }

    // æ£€æŸ¥é‡ç½®å¯†ç åŒ¹é…
    function checkResetPasswordMatch() {
        const password = document.getElementById('resetNewPassword').value;
        const confirm = document.getElementById('resetConfirmPassword').value;
        const btn = document.getElementById('step4Btn');
        const error = document.getElementById('resetConfirmError');

        if (confirm.length === 0) {
            error.classList.remove('show');
            btn.disabled = true;
            btn.style.opacity = '0.5';
            return;
        }

        if (password === confirm && password.length >= 8) {
            error.classList.remove('show');
            btn.disabled = false;
            btn.style.opacity = '1';
        } else {
            error.classList.add('show');
            btn.disabled = true;
            btn.style.opacity = '0.5';
        }
    }

    // åˆ‡æ¢é‡ç½®å¯†ç æ˜¾ç¤º
    function toggleResetPassword() {
        const input = document.getElementById('resetNewPassword');
        const icon = event.target;

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        }
    }

    // é‡ç½®è´¦å·æ•°æ®
    function resetAccountData() {
        const username = document.getElementById('forgotUsername').value.trim();
        const newPassword = document.getElementById('resetNewPassword').value;
        const confirmPassword = document.getElementById('resetConfirmPassword').value;

        // éªŒè¯
        if (!username) {
            alert('è¯·è¾“å…¥ç”¨æˆ·å');
            return;
        }

        if (newPassword !== confirmPassword) {
            alert('ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´');
            return;
        }

        if (newPassword.length < 8) {
            alert('å¯†ç é•¿åº¦è‡³å°‘8ä½');
            return;
        }

        // ç¡®è®¤æ“ä½œ
        if (!confirm('âš ï¸ ç¡®å®šè¦é‡ç½®è¯¥è´¦å·å—ï¼Ÿæ­¤æ“ä½œå°†æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬å‘å¸ƒçš„åŠ¨æ€ï¼‰ï¼Œæ— æ³•æ’¤é”€ï¼')) {
            return;
        }

        // è·å–ç”¨æˆ·æ•°æ®
        const users = JSON.parse(localStorage.getItem('z_users') || '{}');
        
        if (!users[username]) {
            alert('ç”¨æˆ·ä¸å­˜åœ¨');
            return;
        }

        // é‡ç½®è´¦å·æ•°æ®
        users[username] = {
            username: username,
            password: btoa(newPassword),
            avatar: `https://picsum.photos/200/200?random=${Date.now()}`,
            tags: ['æ½®æµæ–°æ˜Ÿ'],
            signature: 'åˆ†äº«æˆ‘çš„æ½®æµæ—¥å¸¸ï½',
            cover: `https://picsum.photos/800/300?random=${Date.now()}`,
            points: 0,
            createTime: new Date().toISOString(),
            updateTime: new Date().toISOString()
        };

        // åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰åŠ¨æ€
        const allPosts = JSON.parse(localStorage.getItem('allPosts') || '[]');
        const filteredPosts = allPosts.filter(post => post.username !== username);
        localStorage.setItem('allPosts', JSON.stringify(filteredPosts));

        // ä¿å­˜ç”¨æˆ·æ•°æ®
        localStorage.setItem('z_users', JSON.stringify(users));

        // æ˜¾ç¤ºæˆåŠŸæç¤º
        showStepBubble();
        showNotification('âœ…', 'è´¦å·é‡ç½®æˆåŠŸï¼è¯·ç”¨æ–°å¯†ç ç™»å½•');

        setTimeout(() => {
            hideForgotModal();
            // æ¸…ç©ºç™»å½•è¡¨å•
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }, 2000);
    }

    // åœ¨ nextStep å‡½æ•°ä¸­æ·»åŠ é‡ç½®è´¦å·é€‰é¡¹
    // ä¿®æ”¹ nextStep å‡½æ•°ä»¥æ”¯æŒæ­¥éª¤4
    const originalNextStep = window.nextStep;
    window.nextStep = function(step) {
        if (step === 4) {
            showResetAccountOption();
        } else {
            originalNextStep(step);
        }
    };

    // åœ¨å¿˜è®°å¯†ç å¼¹çª—ä¸­æ·»åŠ "æ— æ³•æ‰¾å›ï¼Ÿ"é“¾æ¥
    // è¿™ä¸ªä¼šåœ¨ step3 ä¸­æ˜¾ç¤º
    // é¡µé¢åŠ è½½åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', () => {
        // ä¸»é¢˜å›¾æ ‡æ›´æ–°
        if (window.ZPlus && window.ZPlus.ThemeManager) {
            ZPlus.ThemeManager.updateToggleIcons();
        }
    });
</script>
</body>
</html>
