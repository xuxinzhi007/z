<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>注册 - Z+潮流社区</title>
    <!-- 引入外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入用户管理模块 -->
    <script src="js/userManager.js"></script>

    <!-- 配置Tailwind CSS -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B35',
                        secondary: '#40BFFF',
                        accent: '#FF7DAB',
                        yellow: '#FFD166',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    }
                }
            }
        }
    </script>

    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 25%, #ff9a9e 50%, #fad0c4 75%, #ffecd2 100%);
            background-size: 400% 400%;
            animation: gradientFlow 20s ease infinite;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* 注册容器 */
        .register-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px 32px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Logo */
        .logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #FF6B35, #FF7DAB);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
            animation: logoPulse 2s ease-in-out infinite;
        }

        @keyframes logoPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 输入框样式 */
        .input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .input-field {
            width: 100%;
            padding: 14px 16px;
            padding-right: 48px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 15px;
            background: #f8fafc;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
        }

        .input-field:focus {
            border: 2px solid transparent;
            background: white;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.15);
            background-image: linear-gradient(white, white),
                            linear-gradient(135deg, #FF6B35, #40BFFF);
            background-origin: border-box;
            background-clip: padding-box, border-box;
        }

        .input-field.error {
            border-color: #ef4444;
            background: #fef2f2;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .input-field::placeholder {
            color: #94a3b8;
        }

        /* 输入框图标 */
        .input-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
        }

        .input-icon:hover {
            color: #FF6B35;
            transform: translateY(-50%) scale(1.2);
        }

        /* 错误提示 */
        .error-message {
            display: none;
            color: #ef4444;
            font-size: 13px;
            margin-top: 6px;
            padding-left: 4px;
            animation: fadeInDown 0.3s;
        }

        .error-message.show {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 密码强度指示器 */
        .password-strength {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .strength-bar {
            flex: 1;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            transition: background 0.3s;
        }

        .strength-bar.active.weak {
            background: #ef4444;
        }

        .strength-bar.active.medium {
            background: #f59e0b;
        }

        .strength-bar.active.strong {
            background: #10b981;
        }

        /* 注册按钮 */
        .register-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            background: linear-gradient(135deg, #FF6B35, #40BFFF);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            animation: buttonPulse 2s ease-in-out infinite;
        }

        @keyframes buttonPulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3); }
            50% { box-shadow: 0 8px 25px rgba(255, 107, 53, 0.5); }
        }

        .register-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(255, 107, 53, 0.4);
        }

        .register-btn:active {
            transform: translateY(0);
        }

        .register-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* 彩色渐变圆环加载动画 */
        .loading-ring {
            display: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #FF6B35, #FF7DAB, #40BFFF, #FF6B35);
            animation: ringRotate 1s linear;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .loading-ring.show {
            display: block;
        }

        .loading-ring::before {
            content: '';
            position: absolute;
            inset: 4px;
            background: white;
            border-radius: 50%;
        }

        @keyframes ringRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* 粒子炸开动画 */
        .particles-container {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            pointer-events: none;
            z-index: 9999;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            opacity: 0;
        }

        .particle.burst {
            animation: particleBurst 0.6s ease-out forwards;
        }

        @keyframes particleBurst {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: var(--tx) var(--ty) scale(0);
                opacity: 0;
            }
        }

        /* 个性标签卡片 */
        .tag-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FF6B35, #40BFFF);
            border-radius: 12px;
            padding: 32px 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-align: center;
            min-width: 280px;
        }

        .tag-card.show {
            opacity: 1;
            transform: translate(-50%, -55%) scale(1);
        }

        .tag-card.hide {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
        }

        .tag-label {
            font-size: 32px;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
            animation: tagBounce 0.6s ease-out;
        }

        @keyframes tagBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .tag-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 24px;
        }

        .tag-actions {
            display: flex;
            gap: 12px;
        }

        .tag-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag-btn.primary {
            background: white;
            color: #FF6B35;
        }

        .tag-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.3);
        }

        .tag-btn.secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .tag-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* 返回按钮 */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .back-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        /* 遮罩层 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 9998;
        }

        .overlay.show {
            opacity: 1;
            pointer-events: all;
        }
    </style>
</head>
<body>
<!-- 返回按钮 -->
<button class="back-btn" onclick="goBack()">
    <i class="fa fa-arrow-left"></i>
</button>

<!-- 注册容器 -->
<div class="register-container">
    <!-- Logo -->
    <div class="logo">Z</div>

    <!-- 标题 -->
    <h1 class="text-2xl font-bold text-center mb-2" style="color: #1E293B;">加入我们！</h1>
    <p class="text-center text-gray-500 mb-8">开启你的潮流之旅～</p>

    <!-- 注册表单 -->
    <form id="registerForm" onsubmit="handleRegister(event)">
        <!-- 用户名输入框 -->
        <div class="input-group">
            <input
                type="text"
                id="username"
                class="input-field"
                placeholder="用户名或邮箱（6-20位，支持特殊字符）"
                autocomplete="username"
            >
            <i class="fa fa-user input-icon"></i>
            <div class="error-message" id="usernameError">
                <span>❌</span>
                <span id="usernameErrorText">潮号格式不对哦～</span>
            </div>
            <p class="text-xs mt-2 text-gray-500">支持字母、数字、邮箱及特殊字符(@._-)</p>
        </div>

        <!-- 密码输入框 -->
        <div class="input-group">
            <input
                type="password"
                id="password"
                class="input-field"
                placeholder="设置密码（8-20位，字母+数字）"
                autocomplete="new-password"
                oninput="checkPasswordStrength()"
            >
            <i class="fa fa-eye-slash input-icon" id="passwordToggle" onclick="togglePassword('password', 'passwordToggle')"></i>
            <div class="password-strength">
                <div class="strength-bar" id="bar1"></div>
                <div class="strength-bar" id="bar2"></div>
                <div class="strength-bar" id="bar3"></div>
                <div class="strength-bar" id="bar4"></div>
            </div>
            <p class="text-xs mt-2 text-gray-500" id="strengthText">请输入密码</p>
            <div class="error-message" id="passwordError">
                <span>❌</span>
                <span id="passwordErrorText">密码格式不对哦～</span>
            </div>
        </div>

        <!-- 确认密码输入框 -->
        <div class="input-group">
            <input
                type="password"
                id="confirmPassword"
                class="input-field"
                placeholder="再输入一次密码"
                autocomplete="new-password"
            >
            <i class="fa fa-eye-slash input-icon" id="confirmToggle" onclick="togglePassword('confirmPassword', 'confirmToggle')"></i>
            <div class="error-message" id="confirmError">
                <span>❌</span>
                <span>两次密码不一致哦～</span>
            </div>
        </div>

        <!-- 注册按钮 -->
        <button type="submit" class="register-btn" id="registerBtn">
            <span id="btnText">开启潮流</span>
            <div class="loading-ring" id="loadingRing"></div>
        </button>
    </form>

    <!-- 登录链接 -->
    <div class="mt-6 text-center">
        <span class="text-sm text-gray-500">已有账号？</span>
        <a href="login.html" class="text-sm font-medium ml-1" style="color: #FF6B35;">立即登录</a>
    </div>
</div>

<!-- 粒子容器 -->
<div class="particles-container" id="particlesContainer"></div>

<!-- 遮罩层 -->
<div class="overlay" id="overlay"></div>

<!-- 个性标签卡片 -->
<div class="tag-card" id="tagCard">
    <div class="tag-label" id="tagLabel">潮流新星</div>
    <div class="tag-subtitle">你的专属身份标签已解锁！</div>
    <div class="tag-actions">
        <button class="tag-btn secondary" onclick="changeTag()">换一个</button>
        <button class="tag-btn primary" onclick="confirmTag()">就用这个</button>
    </div>
</div>

<script>
    // 潮流标签列表
    const trendTags = ['潮流新星', '元气玩家', '潮圈新人'];
    let currentTagIndex = 0;
    let autoConfirmTimer = null;
    let registeredUsername = '';
    let registeredPassword = '';

    // 返回功能
    function goBack() {
        window.location.href = 'index.html';
    }

    // 密码显示/隐藏切换
    function togglePassword(inputId, iconId) {
        const passwordInput = document.getElementById(inputId);
        const toggleIcon = document.getElementById(iconId);

        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('fa-eye-slash');
            toggleIcon.classList.add('fa-eye');
        } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('fa-eye');
            toggleIcon.classList.add('fa-eye-slash');
        }
    }

    // 检查密码强度
    function checkPasswordStrength() {
        const password = document.getElementById('password').value;
        const bars = ['bar1', 'bar2', 'bar3', 'bar4'];
        const strengthText = document.getElementById('strengthText');

        // 重置
        bars.forEach(bar => {
            document.getElementById(bar).classList.remove('active', 'weak', 'medium', 'strong');
        });

        if (password.length === 0) {
            strengthText.textContent = '请输入密码';
            strengthText.style.color = '#94a3b8';
            return;
        }

        let strength = 0;
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^a-zA-Z0-9]/.test(password)) strength++;

        let level, levelText, color;
        if (strength <= 2) {
            level = 'weak';
            levelText = '密码强度：弱';
            color = '#ef4444';
            bars.slice(0, 1).forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        } else if (strength <= 3) {
            level = 'medium';
            levelText = '密码强度：中等';
            color = '#f59e0b';
            bars.slice(0, 3).forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        } else {
            level = 'strong';
            levelText = '密码强度：强';
            color = '#10b981';
            bars.forEach(bar => {
                document.getElementById(bar).classList.add('active', level);
            });
        }

        strengthText.textContent = levelText;
        strengthText.style.color = color;
    }

    // 注册表单提交
    function handleRegister(event) {
        event.preventDefault();

        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // 重置错误状态
        document.querySelectorAll('.input-field').forEach(field => {
            field.classList.remove('error');
        });
        document.querySelectorAll('.error-message').forEach(msg => {
            msg.classList.remove('show');
        });

        // 验证
        let hasError = false;

        // 验证用户名（6-20位，支持字母、数字、邮箱及特殊字符@._-）
        const usernameRegex = /^[a-zA-Z0-9@._-]{6,20}$/;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        if (!username) {
            document.getElementById('username').classList.add('error');
            document.getElementById('usernameErrorText').textContent = '请输入用户名或邮箱～';
            document.getElementById('usernameError').classList.add('show');
            hasError = true;
        } else if (!usernameRegex.test(username) && !emailRegex.test(username)) {
            document.getElementById('username').classList.add('error');
            document.getElementById('usernameErrorText').textContent = '用户名格式不正确，6-20位，支持字母数字及@._-';
            document.getElementById('usernameError').classList.add('show');
            hasError = true;
        }

        // 验证密码（8-20位，必须包含字母和数字）
        if (!password) {
            document.getElementById('password').classList.add('error');
            document.getElementById('passwordErrorText').textContent = '请输入密码～';
            document.getElementById('passwordError').classList.add('show');
            hasError = true;
        } else if (password.length < 8 || password.length > 20) {
            document.getElementById('password').classList.add('error');
            document.getElementById('passwordErrorText').textContent = '密码长度需要8-20位～';
            document.getElementById('passwordError').classList.add('show');
            hasError = true;
        } else if (!/[a-zA-Z]/.test(password) || !/[0-9]/.test(password)) {
            document.getElementById('password').classList.add('error');
            document.getElementById('passwordErrorText').textContent = '密码必须包含字母和数字～';
            document.getElementById('passwordError').classList.add('show');
            hasError = true;
        }

        // 验证确认密码
        if (password !== confirmPassword) {
            document.getElementById('confirmPassword').classList.add('error');
            document.getElementById('confirmError').classList.add('show');
            hasError = true;
        }

        if (hasError) {
            // 震动反馈
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
            return;
        }

        // 保存用户名和密码,等待标签选择后再注册
        registeredUsername = username;
        registeredPassword = password;

        // 开始注册动画
        startRegisterAnimation();
    }

    // 开始注册动画
    function startRegisterAnimation() {
        const registerBtn = document.getElementById('registerBtn');
        const btnText = document.getElementById('btnText');
        const loadingRing = document.getElementById('loadingRing');

        // 显示加载圆环
        registerBtn.classList.add('loading');
        btnText.style.display = 'none';
        loadingRing.classList.add('show');

        // 1秒后圆环旋转结束，触发粒子炸开
        setTimeout(() => {
            loadingRing.classList.remove('show');
            createParticles();
            
            // 0.3秒后显示标签卡片
            setTimeout(() => {
                showTagCard();
            }, 300);
        }, 1000);
    }

    // 创建粒子炸开效果
    function createParticles() {
        const container = document.getElementById('particlesContainer');
        const colors = ['#FF6B35', '#40BFFF', '#FF7DAB'];
        const particleCount = 5;

        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.background = colors[i % colors.length];

            // 计算散射方向（圆形分布）
            const angle = (360 / particleCount) * i;
            const distance = window.innerWidth / 4;
            const tx = Math.cos(angle * Math.PI / 180) * distance;
            const ty = Math.sin(angle * Math.PI / 180) * distance;

            particle.style.setProperty('--tx', `translate(${tx}px, ${ty}px)`);
            particle.style.setProperty('--ty', '');

            container.appendChild(particle);

            // 触发动画
            setTimeout(() => {
                particle.classList.add('burst');
            }, 10);

            // 动画结束后移除
            setTimeout(() => {
                particle.remove();
            }, 600);
        }
    }

    // 显示标签卡片
    function showTagCard() {
        const overlay = document.getElementById('overlay');
        const tagCard = document.getElementById('tagCard');

        overlay.classList.add('show');
        tagCard.classList.add('show');

        // 随机选择标签
        currentTagIndex = Math.floor(Math.random() * trendTags.length);
        document.getElementById('tagLabel').textContent = trendTags[currentTagIndex];

        // 3秒后自动确认
        autoConfirmTimer = setTimeout(() => {
            confirmTag();
        }, 3000);
    }

    // 更换标签
    function changeTag() {
        // 清除自动确认计时器
        if (autoConfirmTimer) {
            clearTimeout(autoConfirmTimer);
        }

        // 切换到下一个标签
        currentTagIndex = (currentTagIndex + 1) % trendTags.length;
        const tagLabel = document.getElementById('tagLabel');
        
        // 添加跳动动画
        tagLabel.style.animation = 'none';
        setTimeout(() => {
            tagLabel.textContent = trendTags[currentTagIndex];
            tagLabel.style.animation = 'tagBounce 0.6s ease-out';
        }, 10);

        // 重新设置自动确认计时器
        autoConfirmTimer = setTimeout(() => {
            confirmTag();
        }, 3000);
    }

    // 确认标签
    function confirmTag() {
        // 清除自动确认计时器
        if (autoConfirmTimer) {
            clearTimeout(autoConfirmTimer);
        }

        const overlay = document.getElementById('overlay');
        const tagCard = document.getElementById('tagCard');
        const selectedTag = trendTags[currentTagIndex];

        // 注册用户到localStorage
        const result = UserManager.registerUser(registeredUsername, registeredPassword, selectedTag);

        if (!result.success) {
            // 注册失败(用户名已存在等)
            alert(result.message);
            window.location.reload();
            return;
        }

        // 隐藏卡片
        tagCard.classList.remove('show');
        tagCard.classList.add('hide');
        overlay.classList.remove('show');

        // 跳转到首页，传递标签信息
        setTimeout(() => {
            window.location.href = `index.html?registered=true&tag=${encodeURIComponent(selectedTag)}`;
        }, 500);
    }
</script>
</body>
</html>

