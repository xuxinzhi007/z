<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾ç¾¤å¹¿åœº - Zä¸–ä»£æ½®æµç¤¾åŒº</title>
    <!-- å¼•å…¥å¤–éƒ¨èµ„æº -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/mobile-optimization.css" rel="stylesheet">
    <!-- å¼•å…¥æ ¸å¿ƒä¸»é¢˜æ ·å¼ -->
    <style type="text/tailwindcss">
        @import url('css/theme-base.css');
    </style>

    <!-- å¼•å…¥ç”¨æˆ·ç®¡ç†æ¨¡å— -->
    <script src="js/userManager.js"></script>
    <!-- å¼•å…¥ç¤¾ç¾¤ç®¡ç†æ¨¡å— -->
    <script src="js/communityManager.js"></script>
    <!-- å¼•å…¥æ‰‹åŠ¿ç®¡ç†æ¨¡å— -->
    <script src="js/gestureManager.js"></script>
    <!-- å¼•å…¥æ ¸å¿ƒä¸»é¢˜å¼•æ“ -->
    <script src="js/theme-core.js"></script>

    <style>
        /* é¡µé¢ç‰¹å®šæ ·å¼ */
        .community-card {
            /* åŸºç¡€æ ·å¼åœ¨ theme-base.css ä¸­å·²æœ‰éƒ¨åˆ†å®šä¹‰ï¼Œæ­¤å¤„ä¿ç•™ç‰¹å®šä¸šåŠ¡æ ·å¼ */
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .community-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .community-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .community-avatar {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
        }

        .community-title {
            flex: 1;
        }

        /* æ ‡é¢˜å’Œæ–‡å­—é€‚é… */
        .community-title h3 {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 4px;
            /* é¢œè‰²ç”± Tailwind dark:text-white æ§åˆ¶ */
        }

        .community-title p {
            font-size: 13px;
            /* é¢œè‰²ç”± Tailwind dark:text-gray-400 æ§åˆ¶ */
            margin: 0;
        }

        .community-description {
            /* é¢œè‰²ç”± Tailwind dark:text-gray-400 æ§åˆ¶ */
            font-size: 14px;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .community-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        /* æš—é»‘æ¨¡å¼åˆ†å‰²çº¿ */
        .dark .community-stats {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .stat {
            flex: 1;
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #FF6B35;
        }

        .stat-label {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .community-action {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            flex: 1;
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn.join {
            background: linear-gradient(135deg, #FF6B35, #FF7DAB);
            color: white;
        }

        .action-btn.join:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 107, 53, 0.3);
        }

        .action-btn.joined {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }

        .action-btn.joined:hover {
            background: #e2e8f0;
        }

        /* åˆ†ç±»è¿‡æ»¤ */
        .category-filter {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 12px;
            margin-bottom: 24px;
            scrollbar-width: none;
        }

        .category-filter::-webkit-scrollbar {
            display: none;
        }

        .category-btn {
            flex-shrink: 0;
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #64748b;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-btn:hover,
        .category-btn.active {
            border-color: #FF6B35;
            color: #FF6B35;
            background: rgba(255, 107, 53, 0.05);
        }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            background: white;
            border-top: 1px solid #e2e8f0;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 0;
            color: #64748b;
            text-decoration: none;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: #FF6B35;
        }

        .nav-item i {
            font-size: 24px;
        }

        @media (max-width: 768px) {
            body {
                padding-bottom: 60px;
            }
        }

        @media (min-width: 769px) {
            .bottom-nav {
                display: none;
            }

            body {
                padding-bottom: 0;
            }
        }
    </style>
</head>

<body class="bg-light text-dark dark:bg-dark dark:text-gray-100 antialiased transition-colors duration-300">
<!-- èƒŒæ™¯å…‰æ–‘è£…é¥° (æš—é»‘æ¨¡å¼ä¸“å±) -->
<div class="fixed inset-0 z-0 pointer-events-none overflow-hidden hidden dark:block">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-primary/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob"></div>
    <div class="absolute -bottom-32 right-1/4 w-96 h-96 bg-secondary/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob" style="animation-delay: 2s"></div>
</div>

<!-- å¯¼èˆªæ  -->
<header id="navbar" class="fixed top-0 left-0 w-full z-50 bg-white/90 dark:bg-dark/90 backdrop-blur shadow-sm dark:shadow-none dark:border-b dark:border-white/5 py-4 transition-all">
    <div class="container mx-auto px-4 md:px-6 flex items-center justify-between">
        <!-- è¿”å›æŒ‰é’®ï¼ˆç§»åŠ¨ç«¯ï¼‰ -->
        <a href="index.html" class="md:hidden flex items-center text-primary hover:text-secondary transition-custom">
            <i class="fa fa-arrow-left text-xl"></i>
        </a>

        <!-- Logo -->
        <a href="index.html" class="hidden md:flex items-center space-x-2">
            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-accent flex items-center justify-center">
                <span class="text-white font-bold text-xl">Z</span>
            </div>
            <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">Z+</span>
        </a>

        <!-- æ ‡é¢˜ -->
        <h1 class="text-lg md:text-xl font-bold dark:text-white">ç¤¾ç¾¤å¹¿åœº</h1>

        <!-- å³ä¾§æ“ä½œåŒº -->
        <div class="flex items-center space-x-4">
            <!-- ä¸»é¢˜åˆ‡æ¢ (æ¡Œé¢ç«¯) -->
            <button id="theme-toggle-desktop" class="hidden md:flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 text-dark dark:text-yellow transition-custom hover:shadow-lg">
                <i class="fa fa-moon-o text-lg"></i>
            </button>
            
            <!-- è¿”å›æŒ‰é’®ï¼ˆæ¡Œé¢ç«¯ï¼‰ -->
            <a href="index.html" class="hidden md:flex items-center space-x-2 text-primary hover:text-secondary transition-custom">
                <i class="fa fa-arrow-left"></i>
                <span>è¿”å›</span>
            </a>
            
            <!-- ä¸»é¢˜åˆ‡æ¢ (ç§»åŠ¨ç«¯) -->
            <button id="theme-toggle-mobile" class="md:hidden text-dark dark:text-yellow hover:text-primary transition-custom">
                <i class="fa fa-moon-o text-xl"></i>
            </button>
        </div>
    </div>
</header>

<main class="pt-24 pb-20 relative z-10">
    <!-- ç¤¾ç¾¤å¹¿åœº -->
    <section class="py-20 bg-transparent">
        <div class="container mx-auto px-4 md:px-6 max-w-4xl">
            <!-- æ ‡é¢˜åŒºåŸŸ -->
            <div class="text-center mb-12 scroll-animate">
                <h1 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4 dark:text-white">
                    å‘ç°<span class="text-primary">ç¤¾ç¾¤</span>
                </h1>
                <p class="text-gray-600 dark:text-gray-300 text-lg">
                    æ‰¾åˆ°å¿—åŒé“åˆçš„æ½®æµçˆ±å¥½è€…ï¼Œä¸€èµ·åˆ†äº«å’Œè®¨è®º
                </p>
            </div>

            <!-- åˆ†ç±»è¿‡æ»¤ -->
            <div class="category-filter scroll-animate" style="transition-delay: 100ms;">
                <button class="category-btn active dark:bg-slate-700 dark:text-white dark:border-slate-600" onclick="filterByCategory('å…¨éƒ¨')">
                    âœ¨ å…¨éƒ¨
                </button>
                <button class="category-btn dark:bg-slate-800 dark:text-gray-300 dark:border-slate-700 dark:hover:border-primary" onclick="filterByCategory('æ¸¸æˆ')">
                    ğŸ® æ¸¸æˆ
                </button>
                <button class="category-btn dark:bg-slate-800 dark:text-gray-300 dark:border-slate-700 dark:hover:border-primary" onclick="filterByCategory('ç©¿æ­')">
                    ğŸ‘— ç©¿æ­
                </button>
                <button class="category-btn dark:bg-slate-800 dark:text-gray-300 dark:border-slate-700 dark:hover:border-primary" onclick="filterByCategory('éŸ³ä¹')">
                    ğŸµ éŸ³ä¹
                </button>
                <button class="category-btn dark:bg-slate-800 dark:text-gray-300 dark:border-slate-700 dark:hover:border-primary" onclick="filterByCategory('ç¾é£Ÿ')">
                    ğŸ” ç¾é£Ÿ
                </button>
                <button class="category-btn dark:bg-slate-800 dark:text-gray-300 dark:border-slate-700 dark:hover:border-primary" onclick="filterByCategory('æ‘„å½±')">
                    ğŸ“¸ æ‘„å½±
                </button>
                <button class="category-btn dark:bg-slate-800 dark:text-gray-300 dark:border-slate-700 dark:hover:border-primary" onclick="filterByCategory('å…¶ä»–')">
                    ğŸŒŸ å…¶ä»–
                </button>
            </div>

            <!-- ç¤¾ç¾¤åˆ—è¡¨ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="communitiesContainer">
                <div class="text-center py-12 text-gray-500 col-span-full">
                    <i class="fa fa-spinner fa-spin text-4xl mb-4"></i>
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- åº•éƒ¨å¯¼èˆª -->
<nav class="bottom-nav md:hidden dark:bg-dark-card dark:border-gray-700">
    <a href="index.html" class="nav-item" data-page="home">
        <i class="fa fa-home"></i>
        <span>é¦–é¡µ</span>
    </a>
    <a href="communities.html" class="nav-item active" data-page="communities">
        <i class="fa fa-users"></i>
        <span>ç¤¾ç¾¤</span>
    </a>
    <a href="post.html" class="nav-item" data-page="post">
        <i class="fa fa-plus-circle"></i>
        <span>å‘å¸ƒ</span>
    </a>
    <a href="profile.html" class="nav-item" data-page="profile">
        <i class="fa fa-user"></i>
        <span>æˆ‘çš„</span>
    </a>
</nav>

<script>
    let currentCategory = 'å…¨éƒ¨';

    // è·å–åˆ†ç±»å›¾æ ‡
    function getCategoryIcon(category) {
        const icons = {
            'æ¸¸æˆ': 'ğŸ®',
            'ç©¿æ­': 'ğŸ‘—',
            'éŸ³ä¹': 'ğŸµ',
            'ç¾é£Ÿ': 'ğŸ”',
            'æ‘„å½±': 'ğŸ“¸',
            'å…¶ä»–': 'ğŸŒŸ'
        };
        return icons[category] || 'âœ¨';
    }

    // åˆ›å»ºç¤¾ç¾¤å¡ç‰‡
    function createCommunityCard(community) {
        const currentUser = UserManager.getCurrentUsername();
        const isMember = CommunityManager.isUserInCommunity(community.id, currentUser);

        // ä½¿ç”¨ glass ç±»å’Œ dark: ç±»é€‚é…ä¸»é¢˜
        return `
            <div class="community-card card-hover glass dark:bg-slate-800/60 dark:border dark:border-white/10 dark:shadow-lg backdrop-blur-md">
                <div class="community-header">
                    <img src="${community.avatar}" alt="${community.name}" class="community-avatar border dark:border-white/10">
                    <div class="community-title">
                        <h3 class="text-dark dark:text-white">${community.name}</h3>
                        <p class="text-gray-500 dark:text-gray-400">${getCategoryIcon(community.category)} ${community.category}</p>
                    </div>
                </div>

                <p class="community-description text-gray-600 dark:text-gray-300">${community.description}</p>

                <div class="community-stats border-gray-100 dark:border-white/10">
                    <div class="stat">
                        <div class="stat-value text-primary">${community.memberCount}</div>
                        <div class="stat-label text-gray-400 dark:text-gray-500">æˆå‘˜</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value text-primary">${community.posts}</div>
                        <div class="stat-label text-gray-400 dark:text-gray-500">åŠ¨æ€</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value text-primary">${community.creator === currentUser ? 'åˆ›å»ºè€…' : 'æµè§ˆ'}</div>
                        <div class="stat-label text-gray-400 dark:text-gray-500">èº«ä»½</div>
                    </div>
                </div>

                <div class="community-action">
                    ${isMember ? `
                        <button class="action-btn joined dark:bg-slate-700 dark:text-gray-300 dark:border-slate-600 dark:hover:bg-slate-600" onclick="leaveCommunity(${community.id})">
                            <i class="fa fa-check mr-1"></i>å·²åŠ å…¥
                        </button>
                    ` : `
                        <button class="action-btn join" onclick="joinCommunity(${community.id})">
                            <i class="fa fa-plus mr-1"></i>åŠ å…¥
                        </button>
                    `}
                </div>
            </div>
        `;
    }

    // åŠ è½½ç¤¾ç¾¤åˆ—è¡¨
    function loadCommunities() {
        const communities = CommunityManager.getAllCommunities();
        const container = document.getElementById('communitiesContainer');

        if (communities.length === 0) {
            container.innerHTML = `
                <div class="text-center py-12 text-gray-500 dark:text-gray-400 col-span-full">
                    <i class="fa fa-inbox text-4xl mb-4 opacity-50"></i>
                    <p>æš‚æ— ç¤¾ç¾¤ï¼Œå¿«å»åˆ›å»ºä¸€ä¸ªå§ï½</p>
                </div>
            `;
            return;
        }

        // æŒ‰åˆ†ç±»è¿‡æ»¤
        let filtered = communities;
        if (currentCategory !== 'å…¨éƒ¨') {
            filtered = communities.filter(c => c.category === currentCategory);
        }

        if (filtered.length === 0) {
            container.innerHTML = `
                <div class="text-center py-12 text-gray-500 col-span-full">
                    <i class="fa fa-inbox text-4xl mb-4 opacity-50"></i>
                    <p>è¿™ä¸ªåˆ†ç±»æš‚æ— ç¤¾ç¾¤ï½</p>
                </div>
            `;
            return;
        }

        // æŒ‰æˆå‘˜æ•°æ’åº
        filtered.sort((a, b) => b.memberCount - a.memberCount);

        container.innerHTML = filtered.map(community => createCommunityCard(community)).join('');
        
        // è§¦å‘äº¤é”™åŠ¨ç”» (æ‰‹åŠ¨è°ƒç”¨ theme-core.js çš„å¢å¼ºå™¨)
        if (window.ZPlus && window.ZPlus.AnimationEnhancer) {
            window.ZPlus.AnimationEnhancer.initStagger();
        }
        
        // ç»‘å®š 3D Tilt
        if (window.ZPlus && window.ZPlus.TiltEngine) {
            window.ZPlus.TiltEngine.init();
        }
    }

    // æŒ‰åˆ†ç±»è¿‡æ»¤
    function filterByCategory(category) {
        currentCategory = category;

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');

        // é‡æ–°åŠ è½½ç¤¾ç¾¤
        loadCommunities();
    }

    // åŠ å…¥ç¤¾ç¾¤
    function joinCommunity(communityId) {
        if (!UserManager.isLoggedIn()) {
            alert('è¯·å…ˆç™»å½•ï½');
            return;
        }

        const result = CommunityManager.joinCommunity(communityId);
        if (result.success) {
            alert('åŠ å…¥ç¤¾ç¾¤æˆåŠŸï¼');
            loadCommunities();
        } else {
            alert(result.message);
        }
    }

    // é€€å‡ºç¤¾ç¾¤
    function leaveCommunity(communityId) {
        if (confirm('ç¡®å®šè¦é€€å‡ºè¿™ä¸ªç¤¾ç¾¤å—ï¼Ÿ')) {
            const result = CommunityManager.leaveCommunity(communityId);
            if (result.success) {
                alert('å·²é€€å‡ºç¤¾ç¾¤');
                loadCommunities();
            } else {
                alert(result.message);
            }
        }
    }

    // é¡µé¢åŠ è½½
    window.addEventListener('DOMContentLoaded', () => {
        loadCommunities();
    });
</script>
</body>
</html>
